{% extends 'CiscoSystemsAuditBundle::base.html.twig' %}

{% block pagetitle %}
    {{ parent() }}:
    {% if edit == true %}
        Field id: #{{ field.id }}
    {% else %}
        new Field
    {% endif %}
{% endblock %}

{% block pagecontent %}
<style type=text/css>
.bs-docs-answers
{
    position: relative;
    margin: 15px 0;
    padding: 39px 19px 14px;
    background-color: white;
    border: 1px solid #DDD;
    -webkit-border-radius: 4px;
    -moz-border-radius: 4px;
    border-radius: 4px;
}

.bs-docs-answers::after {
    content: "Answers";
    position: absolute;
    top: -1px;
    left: -1px;
    padding: 3px 7px;
    font-size: 12px;
    font-weight: bold;
    background-color: whiteSmoke;
    border: 1px solid #DDD;
    color: #9DA0A4;
    -webkit-border-radius: 4px 0 4px 0;
    -moz-border-radius: 4px 0 4px 0;
    border-radius: 4px 0 4px 0;
}
.shadow-element {
    opacity: .5;
    background-color: red;
    padding-: 4px 6px
}
</style>
<div class="container">
    <div class="span11">
        <form class="form-horizontal" method="POST" action="">
            <div class="pull-right">
                <button type="submit" class="btn btn-mini">
                    Save Field <i class="icon-ok"></i>
                </button>
                {% if field.section.id is defined %}
                    <a class="btn btn-mini"
                        href="{{ path( 'cisco_auditsection_edit', { 'section_id': field.section.id } ) }}">
                         Cancel <i class="icon-remove"></i>
                    </a>
                {% endif %}
                {% if edit == true %}
                    <a class="btn btn-mini"
                        href="{{ path( 'cisco_auditfield_delete', { 'field_id': field.id } ) }}">
                         Delete Field <i class="icon-trash"></i>
                    </a>
                {% endif %}
            </div>
            <div class="controls controls-row">
                <div class="control-group">
                    <div class="control-label">
                        {{ form_label( form.title ) }}
                    </div>
                    <div class="controls" required="required">
                        {{ form_widget( form.title ) }}
                        {{ form_errors( form.title ) }}
                    </div>
                </div>
            </div>
            <div class="controls controls-row">
                <div class="control-group">
                    <div class="control-label">
                        {{ form_label( form.section ) }}
                    </div>
                    <div class="controls">
                        {{ form_widget( form.section ) }}
                        {{ form_errors( form.section ) }}
                    </div>
                </div>
            </div>
            <div class="controls controls-row">
                <div class="control-group">
                    <div class="control-label">
                        {{ form_label( form.flag ) }}
                    </div>
                    <div class="controls">
                        {{ form_widget( form.flag ) }}
                        {{ form_errors( form.flag ) }}
                    </div>
                </div>
            </div>
            <div class="controls controls-row">
                <div class="control-group">
                    <div class="control-label">
                        {{ form_label( form.weight ) }}
                    </div>
                    <div class="controls">
                        {{ form_widget( form.weight ) }}
                        {{ form_errors( form.weight ) }}
                    </div>
                </div>
            </div>
            <div class="controls controls-row">
                <div class="control-group">
                    <div class="control-label">
                        {{ form_label( form.description ) }}
                    </div>
                    <div class="controls">
                        {{ form_widget( form.description, { 'attr': { 'class': 'input-xxlarge' }}) }}
                        {{ form_errors( form.description ) }}
                    </div>
                </div>
            </div>
            <div class="bs-docs-answers">
                <div class="controls controls-row">
                    <div class="control-group">
                        <div class="control-label">
                            {{ form_label( form.answer_yes ) }}
                        </div>
                        <div class="controls">
                            {{ form_widget( form.answer_yes, { 'attr': {'class': 'input-xxlarge' }}) }}
                            {{ form_errors( form.answer_yes ) }}
                        </div>
                    </div>
                </div>
                <div class="controls controls-row">
                    <div class="control-group">
                        <div class="control-label">
                            {{ form_label( form.answer_no ) }}
                        </div>
                        <div class="controls">
                            {{ form_widget( form.answer_no, { 'attr': { 'class': 'input-xxlarge' }}) }}
                            {{ form_errors( form.answer_no ) }}
                        </div>
                    </div>
                </div>
                <div class="controls controls-row">
                    <div class="control-group">
                        <div class="control-label">
                            {{ form_label( form.answer_acceptable ) }}
                        </div>
                        <div class="controls">
                            {{ form_widget( form.answer_acceptable, { 'attr': {  'class': 'input-xxlarge' }}) }}
                            {{ form_errors( form.answer_acceptable ) }}
                        </div>
                    </div>
                </div>
                <div class="controls controls-row">
                    <div class="control-group">
                        <div class="control-label">
                            {{ form_label( form.answer_not_applicable) }}
                        </div>
                        <div class="controls">
                            {{ form_widget( form.answer_not_applicable, { 'attr': {'class': 'input-xxlarge' }}) }}
                            {{ form_errors( form.answer_not_applicable ) }}
                        </div>
                    </div>
                </div>
            </div>
        </form>
    <script type="text/javascript">
        var multipleAllowed = {{ field.section.auditform.allowMultipleAnswer | json_encode() }};
        var flagged = {{ field.flag | json_encode()}};
        var disabledFieldLabel = 'the form does not allow for more than YES/NO answers to be defined';
        var disabledWeightLabel = 'No weight can be set for a Field with a flag/trigger';

        function toggleWeightAnswer()
        {
            if( $( '.cisco-audit-flag-ckbox' ).is( ':checked' ))
            {
                $( '#field_weight' ).attr('disabled', 'disabled');
            }
            else
            {
                $( '#field_weight' ).removeAttr('disabled');
                $( '.controls' ).children().remove( '.shadow-element' );
            }
        }

        function toggleBinaryAnswer()
        {
            if( $( '.cisco-audit-flag-ckbox' ).is( ':checked' ) &&  multipleAllowed === false )
            {
                $( '#field_answer_acceptable' ).attr('disabled', 'disabled');
                $( '#field_answer_not_applicable' ).attr('disabled', 'disabled');
            }
            else
            {
                $( '#field_answer_acceptable' ).removeAttr('disabled');
                $( '#field_answer_not_applicable' ).removeAttr('disabled');
                $( '.controls' ).children().remove( '.shadow-element' );
            }
        };

        /**
         * http://jsfiddle.net/BbspX/1/
         * @returns {undefined}
         */
        function tooltipOnDisabled()
        {
            $( 'textarea:disabled, input[type=number]:disabled' ).after( function( e )
            {
                if( $( this ).next( 'div' ).hasClass( 'shadow-element' ))
                {
                    $( this ).next( 'div' ).remove();
                }
                var that = $( this );
                var top = that.position().top + 'px';
                var left = that.position().left + 'px';
                that.css({ top: top, left: left, position: 'absolute' });
                var newElement = $( '<div>' );
                newElement.addClass( 'shadow-element' );
                newElement.css({
                    /**top: that.position().top + 'px',
                    left: that.position().left + 'px',**/
                    top: 0,
                    left: 0,
                    height: that.outerHeight(),
                    width: that.outerWidth(),
                    zIndex: 5000,
                    /**position: 'absolute'**/
                });
                newElement.css( that.offset());
                newElement.attr( 'data-toggle', 'tooltip' );
                newElement.attr( 'title', '' );
                newElement.attr( 'data-original-title', that.attr( 'data-original-title' ));
                newElement.tooltip({ trigger: 'hover', html: 'true', placement: 'right' });
                return newElement;
            });
        };

        $( '.cisco-audit-flag-ckbox' ).on( 'click', function()
        {
            toggleWeightAnswer();
            toggleBinaryAnswer();
            tooltipOnDisabled();
        });

        $( document ).ready( function()
        {
            toggleWeightAnswer();
            toggleBinaryAnswer();
            tooltipOnDisabled();

            $( '#field_flag' ).tooltip({ html: 'true', placement: 'right' });
            $( '#field_weight' ).tooltip({ html: 'true', placement: 'right' });
            $( '#field_answer_acceptable' ).tooltip({ html: 'true', placement: 'right' });
            $( '#field_answer_not_applicable' ).tooltip({ html: 'true', placement: 'right' });
        });

    </script>
    </div>
</div>
{% endblock %}
